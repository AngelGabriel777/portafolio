import React, { useState, useEffect, useMemo, useRef, useCallback } from 'react';
import { 
  Shield, Terminal, Database, Network, ExternalLink, 
  Mail, Linkedin, Download, Award, ChevronRight,
  Cpu, Lock, Globe, Zap, Target, Activity, HardDrive,
  Menu, X, ChevronDown, CheckCircle2, Fingerprint, 
  MessageSquare, MapPin, Phone, Github, Code, Server, 
  Briefcase, BookOpen, UserCheck, Eye, Scan, Smartphone
} from 'lucide-react';

// --- DATA CONFIGURATION ---

const SKILLS = [
  { name: "Análisis de Vulnerabilidades", level: 85, color: "from-cyan-500 to-blue-500" },
  { name: "Redes TCP/IP & Control Acceso", level: 90, color: "from-blue-500 to-indigo-600" },
  { name: "Hardening de Sistemas (Linux)", level: 88, color: "from-purple-500 to-rose-500" },
  { name: "Respuesta a Incidentes", level: 80, color: "from-emerald-500 to-teal-500" },
];

const PROJECTS = [
  {
    title: "Laboratorio Servidores Seguros",
    subtitle: "UBUNTU SERVER OPS",
    desc: "Configuración integral de servidores DNS, DHCP, FTP, SFTP y SSH con políticas de seguridad, hardening y gestión de claves SSH vía PuTTY.",
    tech: ["Linux", "SSH", "Hardening", "PuTTY"],
    icon: <Terminal size={20}/>
  },
  {
    title: "Automatización con IA & n8n",
    subtitle: "WHATSAPP CLOUD API",
    desc: "Flujo automatizado para gestión de pedidos. Integración con Supabase para órdenes en tiempo real. Reducción del 30% en tiempos de atención.",
    tech: ["n8n", "Supabase", "JS", "Cloud API"],
    icon: <MessageSquare size={20}/>
  },
  {
    title: "Plataforma Restpuntos",
    subtitle: "GEOLOCALIZACIÓN & SQL",
    desc: "Sistema de fidelización para restaurantes con gestión de transacciones en tiempo real y buscador mediante geoposicionamiento.",
    tech: ["React", "PostgreSQL", "Supabase"],
    icon: <MapPin size={20}/>
  }
];

const CERTIFICATIONS = [
  { title: "Certified in Cybersecurity (CC)", org: "(ISC)²", year: "2025", icon: <Shield size={24}/> },
  { title: "Technical Intro to Cybersecurity 1.0", org: "Fortinet", year: "2025", icon: <Network size={24}/> },
  { title: "Introduction to the Threat Landscape 2.0", org: "Fortinet", year: "2025", icon: <Lock size={24}/> },
  { title: "Bootcamp en Programación", org: "MinTIC & ANDES", year: "2025", icon: <Terminal size={24}/> },
  { title: "Crea Agentes de IA Sin Programar", org: "Udemy n8n", year: "2024", icon: <Cpu size={24}/> },
  { title: "Fundamentos de Python", org: "Platzi", year: "2023", icon: <Code size={24}/> }
];

// --- COMPONENTS ---

const CyberBackground = ({ mousePos }) => (
  <div className="fixed inset-0 z-0 pointer-events-none overflow-hidden bg-[#020617]">
    <div 
      className="absolute inset-0 opacity-[0.05] transition-opacity duration-700"
      style={{
        backgroundImage: `linear-gradient(to right, #1e293b 1px, transparent 1px), linear-gradient(to bottom, #1e293b 1px, transparent 1px)`,
        backgroundSize: '50px 50px',
        maskImage: `radial-gradient(circle 500px at ${mousePos.x}px ${mousePos.y}px, black, transparent)`
      }}
    />
    <div 
      className="absolute inset-0 opacity-[0.08]"
      style={{ 
        background: `radial-gradient(1000px at ${mousePos.x}px ${mousePos.y}px, rgba(6, 182, 212, 0.15), transparent 80%)`,
      }}
    />
  </div>
);

const SectionTitle = ({ icon: Icon, title, subtitle }) => (
  <div className="mb-12">
    <div className="flex items-center gap-3 mb-2">
      <div className="p-2 bg-cyan-500/10 rounded-lg">
        <Icon className="text-cyan-500" size={24} />
      </div>
      <h2 className="text-3xl font-black text-white tracking-tighter uppercase">{title}</h2>
    </div>
    {subtitle && <p className="text-slate-500 font-mono text-xs uppercase tracking-widest ml-12">{subtitle}</p>}
  </div>
);

const SkillBar = ({ skill, index, isLoaded }) => (
  <div className="space-y-2">
    <div className="flex justify-between text-[10px] font-mono uppercase tracking-wider">
      <span className="text-slate-300">{skill.name}</span>
      <span className="text-cyan-400">{skill.level}%</span>
    </div>
    <div className="h-1.5 w-full bg-slate-800 rounded-full overflow-hidden border border-white/5 p-[1px]">
      <div 
        className={`h-full bg-gradient-to-r ${skill.color} transition-all duration-1000 ease-out`}
        style={{ width: isLoaded ? `${skill.level}%` : '0%', transitionDelay: `${index * 100}ms` }}
      />
    </div>
  </div>
);

const App = () => {
  const [mousePos, setMousePos] = useState({ x: 0, y: 0 });
  const [activeSection, setActiveSection] = useState('inicio');
  const [isLoaded, setIsLoaded] = useState(false);
  const [isMenuOpen, setIsMenuOpen] = useState(false);
  const rafRef = useRef();

  // Optimización del movimiento del mouse con requestAnimationFrame
  const handleMouseMove = useCallback((e) => {
    if (rafRef.current) cancelAnimationFrame(rafRef.current);
    rafRef.current = requestAnimationFrame(() => {
      setMousePos({ x: e.clientX, y: e.clientY });
    });
  }, []);

  useEffect(() => {
    window.addEventListener('mousemove', handleMouseMove);
    const timer = setTimeout(() => setIsLoaded(true), 100);

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) setActiveSection(entry.target.id);
      });
    }, { threshold: 0.3 });
    
    document.querySelectorAll('section[id]').forEach(s => observer.observe(s));

    return () => {
      window.removeEventListener('mousemove', handleMouseMove);
      clearTimeout(timer);
      observer.disconnect();
    };
  }, [handleMouseMove]);

  const navLinks = [
    { name: 'Inicio', id: 'inicio' },
    { name: 'Perfil', id: 'perfil' },
    { name: 'Proyectos', id: 'proyectos' },
    { name: 'Educación', id: 'educacion' },
    { name: 'Certificaciones', id: 'certificaciones' },
  ];

  return (
    <div className={`min-h-screen bg-[#020617] text-slate-300 selection:bg-cyan-500/30 selection:text-cyan-200 transition-opacity duration-700 ${isLoaded ? 'opacity-100' : 'opacity-0'}`}>
      <CyberBackground mousePos={mousePos} />

      {/* --- NAVBAR --- */}
      <nav className="fixed top-0 w-full z-[100] bg-[#020617]/80 backdrop-blur-xl border-b border-white/5 h-20 flex items-center transition-all duration-300">
        <div className="max-w-7xl mx-auto w-full flex justify-between items-center px-6">
          <div className="flex items-center gap-4 group cursor-default">
            <div className="relative">
                <div className="absolute inset-0 bg-cyan-500 blur-md opacity-20 group-hover:opacity-40 transition-opacity" />
                <div className="relative bg-[#0a0f1d] border border-cyan-500/30 p-2 rounded-xl">
                    <Fingerprint className="text-cyan-400 w-6 h-6" />
                </div>
            </div>
            <div className="flex flex-col">
              <span className="text-white font-black text-xl leading-none tracking-tighter uppercase">GABRIEL IBARRA</span>
              <span className="text-[10px] text-cyan-500 font-mono tracking-[0.2em] uppercase">Security Analyst</span>
            </div>
          </div>
          
          <div className="hidden lg:flex items-center gap-10">
            {navLinks.map((link) => (
              <a 
                key={link.id} 
                href={`#${link.id}`} 
                className={`text-[10px] font-mono uppercase tracking-[0.2em] transition-all relative py-2 group`}
              >
                <span className={activeSection === link.id ? 'text-cyan-400' : 'text-slate-500 group-hover:text-white'}>
                    {link.name}
                </span>
                <span className={`absolute bottom-0 left-0 h-[2px] bg-cyan-500 transition-all duration-300 ${activeSection === link.id ? 'w-full' : 'w-0'}`} />
              </a>
            ))}
            <div className="flex gap-5 border-l border-white/10 pl-8">
              <a href="https://linkedin.com" target="_blank" className="hover:text-cyan-400 transition-colors hover:scale-110"><Linkedin size={20} /></a>
              <a href="mailto:email@domain.com" className="hover:text-cyan-400 transition-colors hover:scale-110"><Mail size={20} /></a>
            </div>
          </div>

          <button className="lg:hidden p-2 text-white hover:bg-white/5 rounded-lg" onClick={() => setIsMenuOpen(!isMenuOpen)}>
            {isMenuOpen ? <X size={28} /> : <Menu size={28} />}
          </button>
        </div>
      </nav>

      {/* --- MOBILE MENU --- */}
      <div className={`fixed inset-0 bg-[#020617] z-[110] flex flex-col p-10 transition-transform duration-500 lg:hidden ${isMenuOpen ? 'translate-x-0' : 'translate-x-full'}`}>
        <div className="flex justify-between items-center mb-16">
            <Fingerprint className="text-cyan-500 w-10 h-10" />
            <button onClick={() => setIsMenuOpen(false)}><X size={40} className="text-slate-500" /></button>
        </div>
        <div className="flex flex-col gap-8">
          {navLinks.map((link) => (
            <a key={link.id} href={`#${link.id}`} onClick={() => setIsMenuOpen(false)} className="text-4xl font-black text-white uppercase tracking-tighter hover:text-cyan-400 transition-colors flex items-center justify-between">
              {link.name} <ChevronRight size={30} className="text-cyan-900" />
            </a>
          ))}
        </div>
      </div>

      <main className="relative z-10 max-w-7xl mx-auto px-6">
        
        {/* --- HERO --- */}
        <section id="inicio" className="min-h-screen flex flex-col justify-center pt-24">
          <div className="grid grid-cols-1 lg:grid-cols-12 gap-16 items-center">
            <div className="lg:col-span-7 space-y-12">
              <div className="inline-flex items-center gap-3 px-4 py-2 rounded-full bg-cyan-500/5 border border-cyan-500/10 text-cyan-400 backdrop-blur-sm">
                <span className="relative flex h-2 w-2">
                    <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-cyan-400 opacity-75"></span>
                    <span className="relative inline-flex rounded-full h-2 w-2 bg-cyan-500"></span>
                </span>
                <span className="text-[10px] font-mono font-bold tracking-[0.2em] uppercase">Available for Junior Roles</span>
              </div>
              
              <div className="space-y-6">
                <h1 className="text-6xl sm:text-7xl md:text-8xl font-black text-white leading-[0.85] tracking-tighter uppercase">
                  ANGEL <br />
                  <span className="text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 via-blue-500 to-indigo-600">GABRIEL.</span>
                </h1>
                <p className="text-slate-400 text-lg md:text-xl leading-relaxed max-w-xl font-light border-l-2 border-cyan-500/30 pl-8">
                  Especializado en <span className="text-white font-semibold">ciberseguridad y redes</span>. 
                  Certificado <span className="text-cyan-400">(ISC)² CC</span>. Enfocado en la resiliencia de infraestructuras críticas y hardening de sistemas.
                </p>
              </div>

              <div className="flex flex-wrap gap-4 pt-4">
                <button className="px-10 py-5 bg-cyan-500 text-[#020617] font-black text-xs uppercase rounded-xl flex items-center gap-3 hover:bg-cyan-400 hover:scale-[1.02] active:scale-95 transition-all shadow-[0_0_30px_rgba(6,182,212,0.2)]">
                  <Download size={18} /> Descargar CV
                </button>
                <div className="flex items-center gap-4 px-8 py-5 bg-white/5 border border-white/10 rounded-xl backdrop-blur-sm">
                  <span className="text-white font-black tracking-tighter text-2xl">B1</span>
                  <div className="h-8 w-[1px] bg-white/10" />
                  <span className="text-[10px] font-mono text-slate-500 uppercase leading-tight tracking-widest text-left">English<br/>Technical</span>
                </div>
              </div>
            </div>

            {/* --- CORE STACK TERMINAL --- */}
            <div className="lg:col-span-5 relative group">
              <div className="absolute -inset-1 bg-gradient-to-r from-cyan-500 to-blue-600 rounded-3xl blur opacity-10 group-hover:opacity-20 transition duration-1000"></div>
              <div className="relative bg-[#0a0f1d] border border-white/10 rounded-2xl overflow-hidden shadow-2xl">
                <div className="px-6 py-4 bg-white/[0.03] border-b border-white/5 flex justify-between items-center">
                  <div className="flex gap-2.5">
                    <div className="w-3 h-3 rounded-full bg-[#ff5f56]" />
                    <div className="w-3 h-3 rounded-full bg-[#ffbd2e]" />
                    <div className="w-3 h-3 rounded-full bg-[#27c93f]" />
                  </div>
                  <span className="text-[10px] font-mono text-slate-500 tracking-[0.2em] uppercase flex items-center gap-2">
                    <Terminal size={14} /> stack_v2.0.sh
                  </span>
                </div>
                <div className="p-10 space-y-10">
                  <div className="space-y-8">
                    {SKILLS.map((skill, i) => (
                      <SkillBar key={skill.name} skill={skill} index={i} isLoaded={isLoaded} />
                    ))}
                  </div>
                  <div className="grid grid-cols-2 gap-5">
                    <div className="p-5 bg-white/[0.03] border border-white/5 rounded-2xl">
                        <Cpu size={20} className="text-cyan-500 mb-3" />
                        <p className="text-[10px] text-slate-500 uppercase mb-2 font-mono">Tools</p>
                        <p className="text-xs font-bold font-mono text-white tracking-tight">NMAP, Wireshark, Kali</p>
                    </div>
                    <div className="p-5 bg-white/[0.03] border border-white/5 rounded-2xl">
                        <Database size={20} className="text-blue-500 mb-3" />
                        <p className="text-[10px] text-slate-500 uppercase mb-2 font-mono">Cloud</p>
                        <p className="text-xs font-bold font-mono text-white tracking-tight">Supabase, n8n, API</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        {/* --- PERFIL --- */}
        <section id="perfil" className="py-32 border-t border-white/5">
          <div className="grid grid-cols-1 lg:grid-cols-12 gap-16">
            <div className="lg:col-span-4">
              <SectionTitle icon={UserCheck} title="Perfil" subtitle="Sobre mi trayectoria" />
            </div>
            <div className="lg:col-span-8">
              <div className="relative group">
                <div className="absolute -inset-1 bg-gradient-to-r from-cyan-500/20 to-transparent blur opacity-0 group-hover:opacity-100 transition duration-500"></div>
                <div className="relative bg-white/[0.02] border border-white/10 p-10 rounded-3xl backdrop-blur-sm">
                    <p className="text-xl md:text-2xl text-slate-300 leading-relaxed font-light">
                    Como estudiante de <span className="text-white font-medium">9º semestre de Ingeniería de Sistemas</span>, he orientado mi carrera hacia la protección de activos digitales. 
                    Poseo un dominio sólido en entornos <span className="text-cyan-400">Linux</span>, administración de redes seguras y automatización de procesos mediante IA. 
                    Mi enfoque combina la <span className="text-white">rigurosidad técnica</span> con una mentalidad proactiva frente a las amenazas emergentes.
                    </p>
                    <div className="flex flex-wrap gap-3 mt-10">
                    {["Pensamiento Analítico", "Ética Hacker", "Resolución de Problemas", "Adaptabilidad"].map(tag => (
                        <span key={tag} className="text-[10px] font-mono px-4 py-2 bg-cyan-500/10 text-cyan-400 border border-cyan-500/20 rounded-lg uppercase tracking-widest">
                        {tag}
                        </span>
                    ))}
                    </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        {/* --- PROYECTOS --- */}
        <section id="proyectos" className="py-32 border-t border-white/5">
          <SectionTitle icon={Briefcase} title="Proyectos" subtitle="Experiencia técnica aplicada" />
          <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
            {PROJECTS.map((p, i) => (
              <div key={i} className="group relative bg-[#0a0f1d] border border-white/5 rounded-3xl overflow-hidden hover:border-cyan-500/30 transition-all duration-500 hover:-translate-y-2">
                <div className="absolute top-0 left-0 w-full h-[2px] bg-gradient-to-r from-transparent via-cyan-500 to-transparent opacity-0 group-hover:opacity-100 transition-opacity" />
                <div className="p-10 space-y-8">
                  <div className="flex justify-between items-start">
                    <div className="p-4 bg-cyan-500/10 rounded-2xl border border-cyan-500/20 text-cyan-500 transition-transform group-hover:scale-110 group-hover:rotate-6">
                        {p.icon}
                    </div>
                    <div className="flex gap-1">
                        <div className="w-1.5 h-1.5 rounded-full bg-cyan-500/40" />
                        <div className="w-1.5 h-1.5 rounded-full bg-cyan-500/40" />
                    </div>
                  </div>
                  <div className="space-y-3">
                    <h3 className="text-2xl font-black text-white group-hover:text-cyan-400 transition-colors tracking-tighter leading-tight uppercase">{p.title}</h3>
                    <p className="text-[10px] font-mono text-slate-500 uppercase tracking-[0.2em]">{p.subtitle}</p>
                  </div>
                  <p className="text-sm text-slate-400 leading-relaxed font-light">{p.desc}</p>
                  <div className="flex flex-wrap gap-2 pt-4">
                    {p.tech.map(t => (
                      <span key={t} className="text-[10px] font-mono px-3 py-1.5 bg-white/5 rounded-lg border border-white/5 text-slate-400 group-hover:border-cyan-500/20 group-hover:text-cyan-100 transition-all">{t}</span>
                    ))}
                  </div>
                </div>
              </div>
            ))}
          </div>
        </section>

        {/* --- EDUCACIÓN & CERTIFICACIONES --- */}
        <section id="educacion" className="py-32 border-t border-white/5">
          <div className="grid grid-cols-1 lg:grid-cols-2 gap-20">
            <div>
              <SectionTitle icon={BookOpen} title="Educación" />
              <div className="bg-gradient-to-br from-cyan-500/10 to-transparent border border-cyan-500/20 p-10 rounded-[2.5rem] relative overflow-hidden group">
                <div className="relative z-10">
                    <h3 className="text-3xl font-black text-white uppercase tracking-tighter">Univ. Simón Bolívar</h3>
                    <p className="text-cyan-500 font-mono text-sm mt-2 uppercase tracking-[0.2em] font-bold">Ingeniería de Sistemas</p>
                    <div className="mt-8 flex flex-col gap-4 text-sm font-mono text-slate-400">
                        <div className="flex items-center gap-3">
                            <Activity size={16} className="text-cyan-500" /> 
                            <span>9º Semestre (2021 - Presente)</span>
                        </div>
                        <div className="flex items-center gap-3">
                            <MapPin size={16} className="text-cyan-500" /> 
                            <span>Cúcuta, Colombia</span>
                        </div>
                    </div>
                </div>
                <div className="absolute top-[-20%] right-[-10%] opacity-5 group-hover:opacity-10 transition-opacity rotate-12">
                    <Cpu size={250} />
                </div>
              </div>
            </div>

            <div id="certificaciones">
              <SectionTitle icon={Award} title="Validaciones" />
              <div className="grid grid-cols-1 gap-4">
                {CERTIFICATIONS.slice(0, 4).map((cert, i) => (
                  <div key={i} className="flex items-center gap-6 p-6 bg-white/[0.02] border border-white/10 rounded-2xl hover:bg-white/[0.04] transition-all group">
                    <div className="p-3 bg-white/5 rounded-xl text-slate-500 group-hover:text-cyan-500 transition-colors">
                        {cert.icon}
                    </div>
                    <div className="flex-grow">
                        <h4 className="text-white font-bold tracking-tight uppercase group-hover:text-cyan-400 transition-colors leading-tight">{cert.title}</h4>
                        <div className="flex items-center gap-3 mt-1">
                            <span className="text-[10px] font-mono text-slate-500 uppercase">{cert.org}</span>
                            <span className="w-1 h-1 rounded-full bg-white/10" />
                            <span className="text-[10px] font-mono text-cyan-600 font-bold">{cert.year}</span>
                        </div>
                    </div>
                    <ChevronRight className="text-slate-700 group-hover:text-cyan-500 transform group-hover:translate-x-1 transition-all" />
                  </div>
                ))}
              </div>
            </div>
          </div>
        </section>

        {/* --- CTA FINAL --- */}
        <section className="py-32">
          <div className="relative bg-[#0a0f1d] border border-white/5 rounded-[3rem] p-16 md:p-24 text-center overflow-hidden shadow-2xl">
            <div className="absolute inset-0 bg-[radial-gradient(circle_at_center,rgba(6,182,212,0.08),transparent_70%)]" />
            <div className="absolute -top-24 -left-24 w-64 h-64 bg-cyan-500/10 blur-[100px] rounded-full" />
            
            <div className="relative z-10 space-y-10">
              <div className="space-y-6">
                <h2 className="text-4xl md:text-6xl font-black text-white tracking-tighter uppercase leading-[0.9]">
                  Iniciemos el <span className="text-cyan-400">Despliegue.</span>
                </h2>
                <p className="text-slate-400 max-w-xl mx-auto font-light text-lg">
                  ¿Buscas un perfil con compromiso, bases sólidas en seguridad y capacidad de adaptación? Hablemos de cómo puedo sumar a tu equipo.
                </p>
              </div>
              <div className="flex flex-col sm:flex-row justify-center items-center gap-6">
                <a 
                  href="mailto:ibarragomezangelgabriel@gmail.com" 
                  className="w-full sm:w-auto px-12 py-5 bg-white text-black font-black text-xs uppercase rounded-2xl hover:bg-cyan-400 transition-all hover:scale-105"
                >
                  Contáctame ahora
                </a>
                <a 
                  href="https://linkedin.com" 
                  target="_blank" 
                  className="w-full sm:w-auto px-12 py-5 bg-white/5 border border-white/10 text-white font-black text-xs uppercase rounded-2xl hover:bg-white/10 transition-all flex items-center justify-center gap-3"
                >
                  <Linkedin size={18} /> Ver LinkedIn
                </a>
              </div>
            </div>
          </div>
        </section>
      </main>

      {/* --- FOOTER --- */}
      <footer className="py-20 border-t border-white/5 bg-black/40 text-center relative z-10">
        <div className="max-w-7xl mx-auto px-6 flex flex-col md:flex-row justify-between items-center gap-8">
          <div className="flex flex-col items-center md:items-start gap-2">
            <p className="text-[10px] font-mono text-slate-500 uppercase tracking-[0.3em]">
              © 2025 ANGEL GABRIEL IBARRA GOMEZ
            </p>
            <p className="text-[9px] font-mono text-cyan-900 uppercase tracking-[0.2em]">
              Sistemas Seguros // Cúcuta, CO
            </p>
          </div>
          <div className="flex gap-4">
            {[
                { icon: <Mail size={20}/>, href: "mailto:ibarragomezangelgabriel@gmail.com" },
                { icon: <Linkedin size={20}/>, href: "https://linkedin.com" },
                { icon: <Github size={20}/>, href: "https://github.com" }
            ].map((social, i) => (
                <a key={i} href={social.href} className="p-4 bg-white/[0.02] border border-white/5 rounded-2xl hover:border-cyan-500/40 hover:text-cyan-400 transition-all">
                    {social.icon}
                </a>
            ))}
          </div>
        </div>
      </footer>

      <style dangerouslySetInnerHTML={{ __html: `
        html { scroll-behavior: smooth; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #020617; }
        ::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #06b6d4; }
        
        @keyframes float {
          0% { transform: translateY(0px); }
          50% { transform: translateY(-10px); }
          100% { transform: translateY(0px); }
        }
        .animate-float { animation: float 6s ease-in-out infinite; }
      `}} />
    </div>
  );
};

export default App;

